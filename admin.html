<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>

  <!-- Quill Editor CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    #editor {
      height: 250px;
    }
  </style>
</head>
<body>
  <h2>Admin Upload Panel</h2>

  <label>Title:</label><br>
  <input type="text" id="title" placeholder="Post title" style="width:100%; padding:8px;"><br><br>

  <label>Category:</label><br>
  <select id="category" style="width:100%; padding:8px;">
    <option value="news">News</option>
    <option value="sports">Sports</option>
    <option value="blogs">Blogs</option>
    <option value="business">Business</option>
    <option value="courses">Courses</option>
    <option value="funny">Funny</option>
  </select><br><br>

  <label>Media File (Image/Video):</label><br>
  <input type="file" id="media"><br><br>

  <label>Content:</label>
  <div id="editor"></div><br>

  <button onclick="uploadPost()">Upload Post</button>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    // ✅ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAwAxP-MWwNnKP59PA6joil4Ceq10eozlc",
      authDomain: "wafula-s-educational-posts.firebaseapp.com",
      projectId: "wafula-s-educational-posts",
      storageBucket: "wafula-s-educational-posts.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // ✅ Quill Init
    const quill = new Quill('#editor', {
      theme: 'snow'
    });

    // ✅ Auth check
    onAuthStateChanged(auth, user => {
      if (!user) {
        alert("Please log in first");
        window.location.href = "login.html";
      }
    });

    // ✅ Upload function
    async function uploadPost() {
      const title = document.getElementById("title").value.trim();
      const category = document.getElementById("category").value;
      const fileInput = document.getElementById("media");
      const file = fileInput.files[0];
      const content = quill.root.innerHTML.trim();

      if (!title || !content || !file) {
        alert("Please fill all fields and select a media file.");
        return;
      }

      try {
        // Upload file to Firebase Storage
        const ext = file.name.split('.').pop();
        const type = file.type.startsWith("video/") ? "video" : "image";
        const filename = `${Date.now()}-${file.name}`;
        const storageRef = ref(storage, `uploads/${filename}`);
        await uploadBytes(storageRef, file);
        const downloadURL = await getDownloadURL(storageRef);

        // Save metadata to Firestore
        await addDoc(collection(db, "posts"), {
          title,
          category,
          content,
          url: downloadURL,
          type,
          timestamp: serverTimestamp()
        });

        alert("Post uploaded successfully!");
        location.reload();
      } catch (error) {
        console.error("Upload failed:", error);
        alert("Upload failed. See console for details.");
      }
    }

    // ✅ Make function accessible to onclick
    window.uploadPost = uploadPost;
  </script>

  <!-- Quill JS -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</body>
</html>