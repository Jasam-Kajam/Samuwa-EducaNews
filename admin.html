<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Samuwa EducaNews</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
</head>
<body class="bg-light">
  <div class="container mt-4">
    <h2 class="text-center mb-4">Samuwa EducaNews Admin</h2><div id="loginDiv">
  <h5>Login</h5>
  <input type="email" id="email" class="form-control mb-2" placeholder="Email" required />
  <input type="password" id="password" class="form-control mb-2" placeholder="Password" required />
  <button class="btn btn-primary" onclick="login()">Login</button>
</div>

<div id="editorDiv" style="display:none;">
  <button class="btn btn-danger float-end" onclick="logout()">Logout</button>
  <h5>Post Article</h5>
  <input type="text" id="title" class="form-control mb-2" placeholder="Title" />
  <input type="text" id="category" class="form-control mb-2" placeholder="Category" />
  <textarea id="editor"></textarea>
  <button class="btn btn-success mt-3" onclick="uploadArticle()">Upload</button>
  <div class="mt-2" id="uploadStatus"></div>
</div>

  </div>  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAwAxP-MWwNnKP59PA6joil4Ceq10eozlc",
      authDomain: "wafula-s-educational-posts.firebaseapp.com",
      projectId: "wafula-s-educational-posts",
      storageBucket: "wafula-s-educational-posts.appspot.com",
      messagingSenderId: "1040710248503",
      appId: "1:1040710248503:web:87fbd02de2b919511577b2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    tinymce.init({
      selector: '#editor',
      plugins: 'image media link code lists',
      toolbar: 'undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | image media link | code',
      height: 300
    });

    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById('loginDiv').style.display = 'none';
          document.getElementById('editorDiv').style.display = 'block';
        })
        .catch(error => alert('Login failed: ' + error.message));
    }

    function logout() {
      auth.signOut().then(() => location.reload());
    }

    function uploadArticle() {
      const title = document.getElementById('title').value.trim();
      const category = document.getElementById('category').value.trim();
      const content = tinymce.get('editor').getContent();
      if (!title || !category || !content) return alert("Fill all fields");

      const htmlFile = new Blob([content], { type: 'text/html' });
      const filename = `articles/${Date.now()}-${title.replace(/\s+/g, '_')}.html`;
      const uploadTask = storage.ref().child(filename).put(htmlFile);

      uploadTask.on('state_changed', (snapshot) => {
        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        document.getElementById('uploadStatus').innerText = `Uploading... ${progress.toFixed(1)}%`;
      }, (error) => {
        alert('Upload failed: ' + error.message);
      }, () => {
        uploadTask.snapshot.ref.getDownloadURL().then(downloadURL => {
          db.collection('articles').add({
            title,
            category,
            url: downloadURL,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          }).then(() => {
            document.getElementById('uploadStatus').innerText = 'Upload successful!';
            tinymce.get('editor').setContent('');
            document.getElementById('title').value = '';
            document.getElementById('category').value = '';
          });
        });
      });
    }
  </script></body>
</html>