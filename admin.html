// Wait for DOM to load
document.addEventListener("DOMContentLoaded", function () {
  const loginBtn = document.getElementById("loginBtn");
  const uploadSection = document.getElementById("upload-section");
  const loginStatus = document.getElementById("loginStatus");

  loginBtn.addEventListener("click", () => {
    const email = document.getElementById("adminEmail").value;
    const password = document.getElementById("adminPassword").value;

    loginStatus.textContent = "Logging in...";

    firebase.auth().signInWithEmailAndPassword(email, password)
      .then((userCredential) => {
        loginStatus.textContent = "Login successful!";
        document.getElementById("login-section").style.display = "none";
        uploadSection.style.display = "block";
      })
      .catch((error) => {
        console.error(error);
        loginStatus.textContent = "Login failed: " + error.message;
      });
  });

  const uploadBtn = document.getElementById("uploadBtn");
  const uploadStatus = document.getElementById("uploadStatus");

  uploadBtn.addEventListener("click", async () => {
    const title = document.getElementById("title").value;
    const category = document.getElementById("category").value;
    const fileInput = document.getElementById("file");
    const file = fileInput.files[0];

    if (!title || !category || !file) {
      uploadStatus.textContent = "Please fill all fields.";
      return;
    }

    uploadStatus.textContent = "Uploading...";

    try {
      const storageRef = firebase.storage().ref(`uploads/${file.name}`);
      await storageRef.put(file);
      const fileURL = await storageRef.getDownloadURL();

      await firebase.firestore().collection("posts").add({
        title,
        category,
        url: fileURL,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      });

      uploadStatus.textContent = "Upload successful!";
      fileInput.value = "";
    } catch (err) {
      console.error(err);
      uploadStatus.textContent = "Upload failed: " + err.message;
    }
  });
});