<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Wafula Posts</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    #editor {
      height: 250px;
      background: #fff;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 10px 20px;
      margin-top: 15px;
      background: #4caf50;
      color: #fff;
      border: none;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<h2>Post Uploader</h2>

<input type="text" id="title" placeholder="Enter title" />
<input type="url" id="videoUrl" placeholder="Optional Video URL" />
<input type="url" id="imageUrl" placeholder="Optional Image URL" />

<select id="category">
  <option value="News">News</option>
  <option value="Blogs">Blogs</option>
  <option value="Courses">Courses</option>
  <option value="Funny">Funny</option>
  <option value="Sports">Sports</option>
  <option value="posts">posts</option>
</select>

<div id="editor"></div>
<button onclick="uploadPost()">Upload</button>

<!-- Quill + Firebase -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAwAxP-MWwNnKP59PA6joil4Ceq10eozlc",
    authDomain: "wafula-s-educational-posts.firebaseapp.com",
    projectId: "wafula-s-educational-posts",
    storageBucket: "wafula-s-educational-posts.appspot.com",
    messagingSenderId: "your-id",
    appId: "your-app-id"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const quill = new Quill('#editor', {
    theme: 'snow'
  });

  onAuthStateChanged(auth, user => {
    if (!user) {
      alert("You must be logged in to access this page.");
      window.location.href = "login.html"; // or your auth page
    }
  });

  async function uploadPost() {
    const title = document.getElementById("title").value;
    const videoUrl = document.getElementById("videoUrl").value;
    const imageUrl = document.getElementById("imageUrl").value;
    const category = document.getElementById("category").value;
    const content = quill.root.innerHTML;

    if (!title || !category || !content) {
      alert("All fields required.");
      return;
    }

    try {
      await addDoc(collection(db, category), {
        title,
        content,
        videoUrl,
        imageUrl,
        timestamp: new Date().toISOString()
      });
      alert("Post uploaded!");
      quill.setContents([]);
      document.getElementById("title").value = "";
      document.getElementById("videoUrl").value = "";
      document.getElementById("imageUrl").value = "";
    } catch (e) {
      console.error("Upload failed:", e);
      alert("Failed to upload.");
    }
  }
</script>
</body>
</html>