<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Samuwa EducaNews</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js"></script>
  <script src="https://cdn.tiny.cloud/1/8s8goqpxlz92x5syaziw5j4j5muvw9kzicvz4vdbpgjenfqt/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
  <style>
    body {
      padding: 20px;
    }
    .post-preview {
      margin-top: 20px;
    }
  </style>
</head><body>
  <div class="container">
    <h2>Welcome to Admin Panel</h2>
    <div id="loginDiv">
      <input type="email" id="email" class="form-control" placeholder="Email">
      <input type="password" id="password" class="form-control mt-2" placeholder="Password">
      <button onclick="login()" class="btn btn-primary mt-2">Login</button>
    </div><div id="adminDiv" style="display:none">
  <button onclick="logout()" class="btn btn-danger float-end">Logout</button>
  <h4>Upload New Post</h4>
  <input type="text" id="title" class="form-control" placeholder="Title">
  <select id="category" class="form-control mt-2">
    <option value="">Select Category</option>
    <option value="news">News</option>
    <option value="sports">Sports</option>
    <option value="blogs">Blogs</option>
    <option value="business">Business</option>
    <option value="courses">Courses</option>
    <option value="funny">Funny</option>
  </select>
  <textarea id="editor" class="form-control mt-2"></textarea>
  <input type="file" id="mediaFile" class="form-control mt-2">
  <button onclick="uploadPost()" class="btn btn-success mt-2">Upload</button>

  <h4 class="mt-4">All Posts</h4>
  <select id="categoryFilter" class="form-control mb-2">
    <option value="all">All</option>
    <option value="news">News</option>
    <option value="sports">Sports</option>
    <option value="blogs">Blogs</option>
    <option value="business">Business</option>
    <option value="courses">Courses</option>
    <option value="funny">Funny</option>
  </select>
  <div id="postsList"></div>
</div>

  </div>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAwAxP-MWwNnKP59PA6joil4Ceq10eozlc",
      authDomain: "wafula-s-educational-posts.firebaseapp.com",
      projectId: "wafula-s-educational-posts",
      storageBucket: "wafula-s-educational-posts.appspot.com",
      messagingSenderId: "",
      appId: "1:1234567890:web:abcdef"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    tinymce.init({
      selector: '#editor',
      plugins: 'image media advtemplate link lists code',
      toolbar: 'undo redo | formatselect | bold italic | alignleft aligncenter alignright | image media link | bullist numlist | code',
      height: 300
    });

    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById('loginDiv').style.display = 'none';
          document.getElementById('adminDiv').style.display = 'block';
          loadPosts();
        })
        .catch(alert);
    }

    function logout() {
      auth.signOut().then(() => {
        document.getElementById('loginDiv').style.display = 'block';
        document.getElementById('adminDiv').style.display = 'none';
      });
    }

    function uploadPost() {
      const title = document.getElementById('title').value;
      const category = document.getElementById('category').value;
      const content = tinymce.get('editor').getContent();
      const file = document.getElementById('mediaFile').files[0];

      if (!title || !category || !content) return alert("Fill in all fields");

      let uploadTask = Promise.resolve(null);
      if (file) {
        const storageRef = storage.ref(`media/${Date.now()}_${file.name}`);
        uploadTask = storageRef.put(file).then(snapshot => snapshot.ref.getDownloadURL());
      }

      uploadTask.then((url) => {
        db.collection("posts").add({
          title,
          category,
          content,
          mediaUrl: url || '',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          alert("Post uploaded");
          loadPosts();
        });
      });
    }

    function loadPosts() {
      const postsList = document.getElementById('postsList');
      const filter = document.getElementById('categoryFilter').value;
      let ref = db.collection("posts").orderBy("timestamp", "desc");
      if (filter !== "all") ref = ref.where("category", "==", filter);

      ref.get().then(snapshot => {
        postsList.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "post-preview";
          div.innerHTML = `
            <h5>${data.title}</h5>
            <p><b>Category:</b> ${data.category}</p>
            ${data.mediaUrl ? `<p><a href="${data.mediaUrl}" target="_blank">View Media</a></p>` : ''}
            <button onclick="deletePost('${doc.id}')" class="btn btn-sm btn-danger">Delete</button>
          `;
          postsList.appendChild(div);
        });
      });
    }

    function deletePost(id) {
      if (confirm("Delete this post?")) {
        db.collection("posts").doc(id).delete().then(loadPosts);
      }
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('loginDiv').style.display = 'none';
        document.getElementById('adminDiv').style.display = 'block';
        loadPosts();
      }
    });

    document.getElementById('categoryFilter').addEventListener('change', loadPosts);
  </script></body></html>