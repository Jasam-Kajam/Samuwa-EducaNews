<!DOCTYPE html>
<html lang="en">
<head>  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Samuwa EducaNews – Inspire Me</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#007bff;
      --accent6:#2e7d32;
      --bg:#f4f6f9;
      --text:#222;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:'Roboto',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}

    /* Header */
    header{
      position:sticky;top:0;z-index:50;
      background:var(--primary);color:#fff;
      padding:10px 20px;display:flex;align-items:center;justify-content:space-between
    }
    .logo{display:flex;align-items:center;font-family:'Times New Roman',serif;font-size:24px;font-weight:bold}
    .logo img{height:40px;width:auto;margin-right:10px;border-radius:6px}

    /* Featured */
    .featured{position:relative;max-width:1100px;margin:20px auto;border-radius:12px;overflow:hidden;height:420px;background:#ddd}
    .featured img{width:100%;height:100%;object-fit:cover;display:block}
    .featured .overlay{
      position:absolute;left:0;right:0;bottom:0;
      background:linear-gradient(transparent,rgba(0,0,0,.8));
      color:#fff;padding:18px;font-size:24px;font-weight:700
    }

    /* Category */
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    .category-title{font-size:22px;font-weight:700;color:#fff;padding:10px;border-radius:8px;margin:34px 0 12px;background:var(--accent6)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:16px}
    .post-card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.08);display:flex;flex-direction:column}
    .post-card img{width:100%;height:180px;object-fit:cover;display:block}
    .post-card .content{padding:12px;flex:1}
    .post-card .title{font-weight:700;margin-bottom:6px}
    .post-card .excerpt{opacity:.85}

    /* Load more */
    .load-more{display:block;margin:30px auto 50px;padding:12px 22px;background:var(--primary);color:#fff;border:0;border-radius:8px;cursor:pointer}

    /* Footer */
    footer{background-color:#0d47a1;color:#fff;padding:40px 20px;font-family:Arial,sans-serif;margin-top:40px}
    footer a{color:#fff;text-decoration:none}
    footer hr{border-color:rgba(255,255,255,.2);margin:20px 0}
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <div class="logo">
      <img src="https://res.cloudinary.com/dkoagpcul/image/upload/v1753858825/file_000000008bd461f489ab78e732435eba_tiqllb.png" alt="Samuwa Logo">
      Samuwa EducaNews – Inspire Me
    </div>
  </header>

  <!-- Featured -->
  <div class="featured" id="featuredStory"></div>

  <!-- Category -->
  <div class="container" id="contentArea"></div>

  <!-- Load More -->
  <button class="load-more" id="loadMoreBtn">Load More</button>

  <!-- Footer -->
  <footer>
    <div style="text-align:center;">&copy; <span id="footerYear"></span> Samuwa EducaNews. All rights reserved.</div>
  </footer>

  <!-- App Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, limit, startAfter } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-lite.js";

    document.getElementById("footerYear").textContent = new Date().getFullYear();

    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAwAxP-MWwNnKP59PA6joil4Ceq10eozlc",
      authDomain: "wafula-s-educational-posts.firebaseapp.com",
      projectId: "wafula-s-educational-posts"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // State
    let lastVisible = null;
    let allPosts = [];
    const category = "inspire me";
    let visibleCount = 4;

    // Utils
    function extractFirstImage(html){
      let src = "https://via.placeholder.com/800x400?text=Inspire+Me";
      if (!html) return src;
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");
      const img = doc.querySelector("img");
      if (img && img.getAttribute("src")) src = img.getAttribute("src");
      return src;
    }
    function stripHTML(s){ return s ? s.replace(/<[^>]*>?/gm,"") : ""; }

    // Fetch posts
    async function fetchPosts(initial=true){
      const qRef = lastVisible
        ? query(collection(db,"posts"), orderBy("timestamp","desc"), startAfter(lastVisible), limit(20))
        : query(collection(db,"posts"), orderBy("timestamp","desc"), limit(20));

      const snap = await getDocs(qRef);
      if (snap.empty) return;

      lastVisible = snap.docs[snap.docs.length-1];
      const batch = snap.docs.map(d => ({ id:d.id, ...d.data() }));
      allPosts = allPosts.concat(batch);

      renderContent(initial);
    }

    // Render Inspire Me only
    function renderContent(initial){
      const inspirePosts = allPosts.filter(p => (p.category||"").toLowerCase() === category);

      if (!inspirePosts.length) return;

      // Featured
      const featured = inspirePosts[0];
      document.getElementById("featuredStory").innerHTML = `
        <a href="posts/categories?id=${featured.id}">
          <img src="${extractFirstImage(featured.article)}" alt="${featured.title}" loading="lazy">
          <div class="overlay">${featured.title}</div>
        </a>
      `;

      // Grid
      const contentArea = document.getElementById("contentArea");
      contentArea.innerHTML = "";
      const section = document.createElement("section");
      const title = document.createElement("div");
      title.className = "category-title";
      title.textContent = "Inspire Me";
      section.appendChild(title);

      const grid = document.createElement("div");
      grid.className = "grid";

      inspirePosts.slice(0, visibleCount).forEach(post => {
        const imgSrc = extractFirstImage(post.article);
        const excerpt = stripHTML(post.article).split(/\s+/).slice(0,20).join(" ");
        const card = document.createElement("div");
        card.className = "post-card";
        card.innerHTML = `
          <a href="posts/categories?id=${post.id}">
            <img src="${imgSrc}" alt="${post.title}" loading="lazy">
          </a>
          <div class="content">
            <div class="title">${post.title}</div>
            <div class="excerpt">${excerpt}...</div>
          </div>
        `;
        grid.appendChild(card);
      });

      section.appendChild(grid);
      contentArea.appendChild(section);

      document.getElementById("loadMoreBtn").style.display = "block";
    }

    async function loadMore(){
      visibleCount += 4;
      renderContent(false);
    }
    document.getElementById("loadMoreBtn").addEventListener("click", loadMore);

    // Initial
    fetchPosts(true);
  </script>

  <!-- Disable right click -->
  <script>
    document.addEventListener("contextmenu", event => event.preventDefault());
  </script>
</body>
  </html>
